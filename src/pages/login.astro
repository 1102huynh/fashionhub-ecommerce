---
import EcommerceLayout from '../layouts/EcommerceLayout.astro';
---

<EcommerceLayout title="Login - FashionHub" description="Sign in to your FashionHub account">
	<div class="auth-container">
		<div class="auth-card">
			<h1>Welcome Back</h1>
			<p class="auth-subtitle">Sign in to continue shopping</p>

			<form id="login-form" class="auth-form">
				<div class="form-group">
					<label for="email">Email Address</label>
					<input
						type="email"
						id="email"
						name="email"
						placeholder="your@email.com"
						required
					>
				</div>

				<div class="form-group">
					<label for="password">Password</label>
					<input
						type="password"
						id="password"
						name="password"
						placeholder="Enter your password"
						required
					>
				</div>

				<div class="form-options">
					<label class="checkbox-label">
						<input type="checkbox" name="remember" id="remember">
						Remember me
					</label>
					<a href="/forgot-password" class="link">Forgot password?</a>
				</div>

				<div id="error-message" class="error-message"></div>

				<button type="submit" class="btn btn-primary btn-full" id="login-btn">
					Sign In
				</button>
			</form>

			<div class="auth-divider">
				<span>or</span>
			</div>

			<div class="social-login">
				<button class="btn btn-social" onclick="alert('Google login coming soon!')">
					<span>üîç</span>
					Continue with Google
				</button>
				<button class="btn btn-social" onclick="alert('Facebook login coming soon!')">
					<span>üìò</span>
					Continue with Facebook
				</button>
			</div>

			<div class="auth-footer">
				Don't have an account? <a href="/register" class="link">Sign up</a>
			</div>
		</div>

		<div class="auth-benefits">
			<h3>Why Shop with FashionHub?</h3>
			<div class="benefit-list">
				<div class="benefit-item">
					<span class="benefit-icon">üöö</span>
					<div>
						<h4>Free Shipping</h4>
						<p>On orders over $50</p>
					</div>
				</div>
				<div class="benefit-item">
					<span class="benefit-icon">üîÑ</span>
					<div>
						<h4>Easy Returns</h4>
						<p>30-day return policy</p>
					</div>
				</div>
				<div class="benefit-item">
					<span class="benefit-icon">üí≥</span>
					<div>
						<h4>Secure Payment</h4>
						<p>SSL encrypted checkout</p>
					</div>
				</div>
				<div class="benefit-item">
					<span class="benefit-icon">‚≠ê</span>
					<div>
						<h4>Member Benefits</h4>
						<p>Exclusive deals & early access</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</EcommerceLayout>

<style>
	.auth-container {
		max-width: 1200px;
		margin: 3rem auto;
		padding: 0 1rem;
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 4rem;
		align-items: start;
	}

	.auth-card {
		background: white;
		padding: 3rem;
		border-radius: 1.5rem;
		box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
		border: 1px solid var(--border-color);
	}

	.auth-card h1 {
		font-size: 2rem;
		margin-bottom: 0.5rem;
		color: var(--text-color);
		text-align: center;
	}

	.auth-subtitle {
		text-align: center;
		color: var(--secondary-color);
		margin-bottom: 2rem;
	}

	.auth-form {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.form-group {
		display: flex;
		flex-direction: column;
	}

	.form-group label {
		margin-bottom: 0.5rem;
		font-weight: 600;
		color: var(--text-color);
	}

	.form-group input {
		padding: 0.875rem;
		border: 2px solid var(--border-color);
		border-radius: 0.5rem;
		font-size: 1rem;
		transition: all 0.2s;
	}

	.form-group input:focus {
		outline: none;
		border-color: var(--primary-color);
		box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
	}

	.form-options {
		display: flex;
		justify-content: space-between;
		align-items: center;
		font-size: 0.875rem;
	}

	.checkbox-label {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		cursor: pointer;
	}

	.checkbox-label input {
		transform: scale(1.2);
	}

	.link {
		color: var(--primary-color);
		text-decoration: none;
		font-weight: 600;
	}

	.link:hover {
		text-decoration: underline;
	}

	.error-message {
		padding: 0.875rem;
		background: #fee;
		border: 1px solid #fcc;
		border-radius: 0.5rem;
		color: #c00;
		font-size: 0.875rem;
		display: none;
	}

	.error-message.show {
		display: block;
	}

	.btn-full {
		width: 100%;
		padding: 1rem;
		font-size: 1.1rem;
		font-weight: 600;
	}

	.auth-divider {
		position: relative;
		text-align: center;
		margin: 2rem 0;
	}

	.auth-divider::before {
		content: '';
		position: absolute;
		left: 0;
		top: 50%;
		width: 100%;
		height: 1px;
		background: var(--border-color);
	}

	.auth-divider span {
		position: relative;
		background: white;
		padding: 0 1rem;
		color: var(--secondary-color);
		font-size: 0.875rem;
	}

	.social-login {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.btn-social {
		width: 100%;
		padding: 0.875rem;
		border: 2px solid var(--border-color);
		background: white;
		border-radius: 0.5rem;
		font-weight: 600;
		cursor: pointer;
		transition: all 0.2s;
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 0.75rem;
		font-size: 1rem;
	}

	.btn-social:hover {
		border-color: var(--primary-color);
		background: rgba(37, 99, 235, 0.05);
	}

	.btn-social span {
		font-size: 1.25rem;
	}

	.auth-footer {
		text-align: center;
		margin-top: 2rem;
		padding-top: 2rem;
		border-top: 1px solid var(--border-color);
		color: var(--secondary-color);
	}

	.auth-benefits {
		background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(37, 99, 235, 0.1));
		padding: 3rem;
		border-radius: 1.5rem;
		border: 1px solid rgba(37, 99, 235, 0.2);
	}

	.auth-benefits h3 {
		font-size: 1.5rem;
		margin-bottom: 2rem;
		color: var(--text-color);
	}

	.benefit-list {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	.benefit-item {
		display: flex;
		gap: 1rem;
		align-items: start;
	}

	.benefit-icon {
		font-size: 2rem;
		flex-shrink: 0;
	}

	.benefit-item h4 {
		margin-bottom: 0.25rem;
		color: var(--text-color);
		font-size: 1.125rem;
	}

	.benefit-item p {
		color: var(--secondary-color);
		font-size: 0.875rem;
	}

	@media (max-width: 968px) {
		.auth-container {
			grid-template-columns: 1fr;
			gap: 2rem;
		}

		.auth-benefits {
			order: -1;
			padding: 2rem;
		}

		.benefit-list {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 1.5rem;
		}
	}

	@media (max-width: 640px) {
		.auth-card {
			padding: 2rem 1.5rem;
		}

		.benefit-list {
			grid-template-columns: 1fr;
		}
	}
</style>

<script>
	import { authManager } from '../stores/auth';

	const loginForm = document.getElementById('login-form') as HTMLFormElement;
	const errorMessage = document.getElementById('error-message') as HTMLElement;
	const loginBtn = document.getElementById('login-btn') as HTMLButtonElement;

	if (loginForm) {
		loginForm.addEventListener('submit', async (e) => {
			e.preventDefault();

			// Get form data
			const formData = new FormData(loginForm);
			const email = formData.get('email') as string;
			const password = formData.get('password') as string;

			// Clear previous errors
			errorMessage.textContent = '';
			errorMessage.classList.remove('show');

			// Disable button
			const originalText = loginBtn.textContent;
			loginBtn.textContent = 'Signing in...';
			loginBtn.disabled = true;

			try {
				// Attempt login
				const result = await authManager.login(email, password);

				if (result.success) {
					// Success - redirect to account or previous page
					const urlParams = new URLSearchParams(window.location.search);
					const returnUrl = urlParams.get('return') || '/account';

					window.location.href = returnUrl;
				} else {
					// Show error
					errorMessage.textContent = result.error || 'Login failed. Please try again.';
					errorMessage.classList.add('show');
					loginBtn.textContent = originalText;
					loginBtn.disabled = false;
				}
			} catch (error) {
				console.error('Login error:', error);
				errorMessage.textContent = 'An unexpected error occurred. Please try again.';
				errorMessage.classList.add('show');
				loginBtn.textContent = originalText;
				loginBtn.disabled = false;
			}
		});
	}

	// Check if already logged in
	if (authManager.isAuthenticated()) {
		const urlParams = new URLSearchParams(window.location.search);
		const returnUrl = urlParams.get('return') || '/account';
		window.location.href = returnUrl;
	}
</script>

