---
import EcommerceLayout from '../layouts/EcommerceLayout.astro';
import ProductCard from '../components/ecommerce/ProductCardEnhanced.astro';
import { mockProducts, mockCategories, mockSizes, mockColors } from '../utils/mock-data.js';


// Get all products for now (in a real app, this would handle filtering and pagination)
const products = mockProducts;
const categories = mockCategories;
const sizes = mockSizes;
const colors = mockColors;
---

<EcommerceLayout title="Products - FashionHub" description="Browse our complete collection of premium clothing and accessories">
	<div class="breadcrumb">
		<a href="/">Home</a>
		<span class="breadcrumb-separator">/</span>
		<span>Products</span>
	</div>

	<div class="page-header">
		<h1>All Products</h1>
		<p>Discover our complete collection of premium clothing and accessories</p>
	</div>

	<div class="products-layout">
		<aside class="filters-sidebar">
			<div class="filter-section">
				<h3>Categories</h3>
				<div class="filter-group">
					{categories.map(category => (
						<label class="filter-item">
							<input type="checkbox" name="category" value={category.id}>
							<span>{category.name}</span>
						</label>
					))}
				</div>
			</div>

			<div class="filter-section">
				<h3>Size</h3>
				<div class="filter-group">
					{sizes.map(size => (
						<label class="filter-item size-filter">
							<input type="checkbox" name="size" value={size.id}>
							<span class="size-badge">{size.name}</span>
						</label>
					))}
				</div>
			</div>

			<div class="filter-section">
				<h3>Color</h3>
				<div class="filter-group color-group">
					{colors.map(color => (
						<label class="color-item" title={color.name}>
							<input type="checkbox" name="color" value={color.id}>
							<span class="color-swatch" style={`background-color: ${color.value}`}></span>
						</label>
					))}
				</div>
			</div>

			<div class="filter-section">
				<h3>Price Range</h3>
				<div class="price-range">
					<label for="price-min" class="sr-only">Minimum price</label>
					<input type="range" id="price-min" min="0" max="200" value="0" class="price-slider">
					<label for="price-max" class="sr-only">Maximum price</label>
					<input type="range" id="price-max" min="0" max="200" value="200" class="price-slider">
					<div class="price-display">
						<span>$<span id="price-min-value">0</span> - $<span id="price-max-value">200</span></span>
					</div>
				</div>
			</div>

			<div class="filter-section">
				<label class="filter-item">
					<input type="checkbox" name="featured" value="true">
					<span>Featured Items</span>
				</label>
				<label class="filter-item">
					<input type="checkbox" name="sale" value="true">
					<span>On Sale</span>
				</label>
				<label class="filter-item">
					<input type="checkbox" name="inStock" value="true">
					<span>In Stock</span>
				</label>
			</div>

			<button id="clear-filters" class="btn btn-outline" style="width: 100%; margin-top: 1rem;">
				Clear All Filters
			</button>
		</aside>

		<main class="products-main">
			<div class="products-header">
				<div class="products-info">
					<span id="products-count">{products.length} products</span>
				</div>
				<div class="sort-controls">
					<label for="sort-select" class="sr-only">Sort products</label>
					<select id="sort-select" class="sort-dropdown">
						<option value="name-asc">Name (A-Z)</option>
						<option value="name-desc">Name (Z-A)</option>
						<option value="price-asc">Price (Low to High)</option>
						<option value="price-desc">Price (High to Low)</option>
						<option value="rating-desc">Highest Rated</option>
						<option value="newest">Newest First</option>
					</select>
				</div>
			</div>

			<div id="products-grid" class="product-grid">
				{products.map(product => (
					<ProductCard product={product} />
				))}
			</div>

			<div id="no-results" class="no-results" style="display: none;">
				<p>No products found matching your criteria.</p>
				<button id="reset-filters" class="btn">Reset Filters</button>
			</div>
		</main>
	</div>
</EcommerceLayout>

<style>
	.page-header {
		text-align: center;
		margin-bottom: 2rem;
	}

	.page-header h1 {
		font-size: 2.5rem;
		margin-bottom: 0.5rem;
	}

	.page-header p {
		color: var(--secondary-color);
		font-size: 1.1rem;
	}

	.products-layout {
		display: grid;
		grid-template-columns: 280px 1fr;
		gap: 2rem;
		margin-top: 2rem;
	}

	.filters-sidebar {
		background: var(--card-background);
		padding: 1.5rem;
		border-radius: 0.5rem;
		height: fit-content;
		position: sticky;
		top: 120px;
	}

	.filter-section {
		margin-bottom: 1.5rem;
		padding-bottom: 1.5rem;
		border-bottom: 1px solid var(--border-color);
	}

	.filter-section:last-child {
		border-bottom: none;
		margin-bottom: 0;
		padding-bottom: 0;
	}

	.filter-section h3 {
		font-size: 1rem;
		margin-bottom: 1rem;
		color: var(--text-color);
	}

	.filter-group {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	.filter-item {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		cursor: pointer;
		font-size: 0.875rem;
	}

	.filter-item input[type="checkbox"] {
		margin: 0;
	}

	.size-filter {
		display: inline-flex;
		width: auto;
	}

	.size-badge {
		background: white;
		border: 1px solid var(--border-color);
		padding: 0.25rem 0.5rem;
		border-radius: 0.25rem;
		font-size: 0.75rem;
		min-width: 2rem;
		text-align: center;
		transition: all 0.2s;
	}

	.size-filter input:checked + .size-badge {
		background: var(--primary-color);
		color: white;
		border-color: var(--primary-color);
	}

	.color-group {
		display: flex;
		flex-direction: row;
		flex-wrap: wrap;
		gap: 0.5rem;
	}

	.color-item {
		cursor: pointer;
		position: relative;
	}

	.color-item input {
		display: none;
	}

	.color-swatch {
		display: block;
		width: 2rem;
		height: 2rem;
		border-radius: 50%;
		border: 2px solid transparent;
		transition: all 0.2s;
	}

	.color-item input:checked + .color-swatch {
		border-color: var(--primary-color);
		box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary-color);
	}

	.price-range {
		position: relative;
	}

	.price-slider {
		width: 100%;
		margin: 0.5rem 0;
		-webkit-appearance: none;
		height: 4px;
		background: var(--border-color);
		border-radius: 2px;
	}

	.price-slider::-webkit-slider-thumb {
		-webkit-appearance: none;
		width: 16px;
		height: 16px;
		background: var(--primary-color);
		border-radius: 50%;
		cursor: pointer;
	}

	.price-display {
		text-align: center;
		font-size: 0.875rem;
		color: var(--secondary-color);
	}

	.products-main {
		min-height: 400px;
	}

	.products-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 1.5rem;
		padding-bottom: 1rem;
		border-bottom: 1px solid var(--border-color);
	}

	.products-info {
		color: var(--secondary-color);
		font-size: 0.875rem;
	}

	.sort-dropdown {
		padding: 0.5rem;
		border: 1px solid var(--border-color);
		border-radius: 0.25rem;
		background: white;
		color: var(--text-color);
	}

	.no-results {
		text-align: center;
		padding: 3rem;
		color: var(--secondary-color);
	}

	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border: 0;
	}

	@media (max-width: 768px) {
		.products-layout {
			grid-template-columns: 1fr;
		}

		.filters-sidebar {
			position: static;
			order: 2;
		}

		.products-main {
			order: 1;
		}

		.products-header {
			flex-direction: column;
			gap: 1rem;
			align-items: stretch;
		}
	}
</style>

<script>
	// Simplified product filtering functionality
	document.addEventListener('DOMContentLoaded', () => {
		const products = document.querySelectorAll('.product-card');
		const productsGrid = document.getElementById('products-grid');
		const productsCount = document.getElementById('products-count');
		const noResults = document.getElementById('no-results');
		const sortSelect = document.getElementById('sort-select') as HTMLSelectElement;
		const clearFiltersBtn = document.getElementById('clear-filters');

		// Filter checkboxes
		document.querySelectorAll('input[type="checkbox"]').forEach(input => {
			input.addEventListener('change', applyFilters);
		});

		// Price range sliders
		const priceMin = document.getElementById('price-min') as HTMLInputElement;
		const priceMax = document.getElementById('price-max') as HTMLInputElement;
		const priceMinValue = document.getElementById('price-min-value');
		const priceMaxValue = document.getElementById('price-max-value');

		priceMin?.addEventListener('input', (e) => {
			const target = e.target as HTMLInputElement;
			if (priceMinValue) priceMinValue.textContent = target.value;
			applyFilters();
		});

		priceMax?.addEventListener('input', (e) => {
			const target = e.target as HTMLInputElement;
			if (priceMaxValue) priceMaxValue.textContent = target.value;
			applyFilters();
		});

		// Sort dropdown
		sortSelect?.addEventListener('change', applySort);

		// Clear filters
		clearFiltersBtn?.addEventListener('click', clearAllFilters);

		function applyFilters() {
			let visibleCount = 0;

			products.forEach(product => {
				// For demo purposes, just show all products
				// In a real app, you'd implement actual filtering logic here
				const isVisible = true;
				(product as HTMLElement).style.display = isVisible ? 'block' : 'none';
				if (isVisible) visibleCount++;
			});

			updateUI(visibleCount);
		}

		function applySort() {
			// Simplified sorting - in a real app, you'd sort based on actual product data
			console.log('Sorting products...');
		}

		function updateUI(visibleCount: number) {
			if (productsCount) {
				productsCount.textContent = `${visibleCount} products`;
			}

			if (noResults) {
				noResults.style.display = visibleCount === 0 ? 'block' : 'none';
			}
		}

		function clearAllFilters() {
			document.querySelectorAll('input[type="checkbox"]').forEach(input => {
				(input as HTMLInputElement).checked = false;
			});

			if (priceMin) {
				priceMin.value = '0';
				if (priceMinValue) priceMinValue.textContent = '0';
			}
			if (priceMax) {
				priceMax.value = '200';
				if (priceMaxValue) priceMaxValue.textContent = '200';
			}

			applyFilters();
		}

		// Initial setup
		applyFilters();
	});
</script>
