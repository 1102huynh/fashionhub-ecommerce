---
import AdminLayout from '../../layouts/AdminLayout.astro';
---

<AdminLayout title="Products Management">
  <!-- Page Header -->
  <div class="page-header">
    <div class="search-bar">
      <input type="text" id="search-products" placeholder="Search products..." class="search-input">
      <button class="btn btn-primary">üîç Search</button>
    </div>
    <div class="header-actions">
      <select id="category-filter" class="filter-select">
        <option value="">All Categories</option>
        <option value="women">Women</option>
        <option value="men">Men</option>
        <option value="accessories">Accessories</option>
      </select>
      <button class="btn btn-success" onclick="alert('Add product feature coming soon!')">
        ‚ûï Add Product
      </button>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="products-grid" id="products-grid">
    <div class="loading">Loading products...</div>
  </div>
</AdminLayout>

<style>
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .search-bar {
    display: flex;
    gap: 0.5rem;
    flex: 1;
    max-width: 500px;
  }

  .search-input {
    flex: 1;
    padding: 0.75rem 1rem;
    border: 1px solid var(--admin-border);
    border-radius: 0.5rem;
  }

  .header-actions {
    display: flex;
    gap: 0.5rem;
  }

  .filter-select {
    padding: 0.75rem 1rem;
    border: 1px solid var(--admin-border);
    border-radius: 0.5rem;
    background: white;
  }

  .btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary {
    background: var(--admin-primary);
    color: white;
  }

  .btn-success {
    background: var(--admin-success);
    color: white;
  }

  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .loading {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem;
    color: var(--admin-text-secondary);
  }

  .product-card {
    background: white;
    border-radius: 0.75rem;
    border: 1px solid var(--admin-border);
    overflow: hidden;
    transition: all 0.2s;
  }

  .product-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
  }

  .product-image {
    width: 100%;
    height: 250px;
    object-fit: cover;
  }

  .product-info {
    padding: 1rem;
  }

  .product-name {
    font-weight: 600;
    margin-bottom: 0.5rem;
    font-size: 1rem;
  }

  .product-category {
    font-size: 0.75rem;
    color: var(--admin-text-secondary);
    text-transform: uppercase;
    margin-bottom: 0.5rem;
  }

  .product-price {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--admin-primary);
    margin-bottom: 0.75rem;
  }

  .product-stock {
    font-size: 0.875rem;
    margin-bottom: 1rem;
  }

  .stock-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .stock-badge.in-stock {
    background: #dcfce7;
    color: #166534;
  }

  .stock-badge.low-stock {
    background: #fef3c7;
    color: #92400e;
  }

  .stock-badge.out-of-stock {
    background: #fee2e2;
    color: #991b1b;
  }

  .product-actions {
    display: flex;
    gap: 0.5rem;
  }

  .action-btn {
    flex: 1;
    padding: 0.5rem;
    border: none;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .action-btn.edit {
    background: var(--admin-primary);
    color: white;
  }

  .action-btn.delete {
    background: var(--admin-danger);
    color: white;
  }

  @media (max-width: 768px) {
    .page-header {
      flex-direction: column;
      align-items: stretch;
    }

    .search-bar {
      max-width: none;
    }

    .products-grid {
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
  }
</style>

<script>
  import { mockProducts } from '../../utils/mock-data';

  function loadProducts() {
    const grid = document.getElementById('products-grid');
    if (!grid) return;

    grid.innerHTML = mockProducts.map(product => {
      const primaryImage = product.images.find(img => img.isPrimary) || product.images[0];
      const stock = Math.floor(Math.random() * 100);
      const stockStatus = stock > 20 ? 'in-stock' : stock > 0 ? 'low-stock' : 'out-of-stock';
      const stockLabel = stock > 20 ? 'In Stock' : stock > 0 ? `Low Stock (${stock})` : 'Out of Stock';

      return `
        <div class="product-card">
          <img src="${primaryImage.url}" alt="${product.name}" class="product-image">
          <div class="product-info">
            <div class="product-category">${product.category}</div>
            <div class="product-name">${product.name}</div>
            <div class="product-price">$${product.price.toFixed(2)}</div>
            <div class="product-stock">
              <span class="stock-badge ${stockStatus}">${stockLabel}</span>
            </div>
            <div class="product-actions">
              <button class="action-btn edit" onclick="editProduct('${product.id}')">
                ‚úèÔ∏è Edit
              </button>
              <button class="action-btn delete" onclick="deleteProduct('${product.id}')">
                üóëÔ∏è Delete
              </button>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  function editProduct(productId: string) {
    alert(`Edit product ${productId} - Feature coming soon!`);
  }

  function deleteProduct(productId: string) {
    if (confirm('Are you sure you want to delete this product?')) {
      alert(`Delete product ${productId} - Feature coming soon!`);
    }
  }

  // Make functions global
  (window as any).editProduct = editProduct;
  (window as any).deleteProduct = deleteProduct;

  // Load products
  loadProducts();

  // Category filter
  document.getElementById('category-filter')?.addEventListener('change', (e) => {
    const category = (e.target as HTMLSelectElement).value;
    const grid = document.getElementById('products-grid');
    if (!grid) return;

    const filtered = category
      ? mockProducts.filter(p => p.category.toLowerCase() === category.toLowerCase())
      : mockProducts;

    if (filtered.length === 0) {
      grid.innerHTML = '<div class="loading">No products found</div>';
      return;
    }

    // Re-render filtered products
    loadProducts();
  });
</script>

